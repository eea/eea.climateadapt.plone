// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(a,g,d,p,b,l){a=a(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(a){a.catalogItems&&(this.catalogItems=new l(a.catalogItems));a.location&&(this.location=b.fromJson(a.location));this.catalogItemVisibilities=a.catalogItemVisibilities;this.name=a.name;this.objectId=a.objectId;this.value=
a.value;this.properties=a.properties}});d("extend-esri")&&g.setObject("tasks.ImageServiceIdentifyResult",a,p);return a})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(a,g,d,p,b,l){a=a(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,
renderingRule:null,noData:null,toJson:function(a){var c=this.bbox||this.extent;a=(c=c&&a&&c._normalize(!0))?c.spatialReference.wkid||d.toJson(c.spatialReference.toJson()):null;var b=this.imageSpatialReference,c={bbox:c?c.xmin+","+c.ymin+","+c.xmax+","+c.ymax:null,bboxSR:a,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:b?b.wkid||d.toJson(b.toJson()):a,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?
this.bandIds.join(","):null,mosaicRule:this.mosaicRule?d.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?d.toJson(this.renderingRule.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation};a=this.timeExtent;c.time=a?a.toJson().join(","):null;return l.filter(c,function(a){if(null!==a&&void 0!==a)return!0})}});g.mixin(a,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",
INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});p("extend-esri")&&g.setObject("layers.ImageServiceParameters",a,b);return a})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(a,g,d,p,b,l,e,c,n,u,z,t,v,s,C){a=a(v,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(a){try{a=g.mixin({bingMapsKey:null,culture:"en-US"},a||{});var c=window.location.protocol;"file:"===c&&(c="http:");this.url=c+"//dev.virtualearth.net/REST/v1";this._url=u.urlToObject(this.url);this.spatialReference=new z({wkid:102100});this.tileInfo=new t({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,
scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},
{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,
scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.initialExtent=this.fullExtent=new s(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new z({wkid:102100}));g.mixin(this,a);this.hasAttributionData=this.showAttribution;this._initLayer=g.hitch(this,this._initLayer);this._errorHandler=g.hitch(this,this._errorHandler);this._getTileInfo=g.hitch(this,this._getTileInfo);if(this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(b){throw this.onError(b),b;}},_unsetMap:function(a,c){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var a=this._url.path+"/Imagery/Metadata/"+this.mapStyle;if(this.bingMapsKey){var c=this.resourceInfo;!this.loaded&&c?this._initLayer(c):C({url:a,content:g.mixin({},{key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},_initLayer:function(a,
c){if(200!==a.statusCode){var b=Error();b.code=a.statusCode;b.message=a.statusDescription;b.details=a.errorDetails;b.authenticationResultCode=a.authenticationResultCode;this.onError(b)}else try{this.resourceInfo=d.toJson(a);var b=a.resourceSets[0].resources[0],g=b.imageUrl.replace("{","${");this.tileServers=p.map(b.imageUrlSubdomains,function(a){var c=window.location.protocol;"file:"===c&&(c="http:");return e.substitute(g,{subdomain:a}).replace("http:",c)});this._tsLength=this.tileServers.length;
if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2012 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var n=this.loadCallback;n&&(delete this.loadCallback,n(this))}}catch(s){this.onError(s)}},getAttributionData:function(){var a=new c,n=d.fromJson(this.resourceInfo),e;this.hasAttributionData&&n&&(e=g.getObject("resourceSets.0.resources.0.imageryProviders",!1,n));e?a.callback({contributors:e}):(n=Error("Layer does not have attribution data"),
n.log=b.isDebug,a.errback(n));return a},getTileUrl:function(a,c,b){return e.substitute(this.tileServers[c%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(a,c,b),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(a,c,b){var g="",d,n;for(n=a;0<n;n--)a="0",d=1<<n-1,0!=(b&d)&&a++,0!=(c&d)&&(a++,a++),g+=a;return g},setMapStyle:function(a){this.mapStyle=a;this._getTileInfo()},setCulture:function(a){this.culture=a;this._getTileInfo()},setBingMapsKey:function(a){this.bingMapsKey=
a},onMapStyleChange:function(){}});g.mixin(a,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"road"});l("extend-esri")&&g.setObject("virtualearth.VETiledLayer",a,n);return a})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../SpatialReference ./MosaicRule ./DynamicMapServiceLayer ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters ../geometry/Polygon".split(" "),
function(a,g,d,p,b,l,e,c,n,u,z,t,v,s,C,w,B,q,A,x,G,E,F,H,D){a=a(A,{declaredClass:"esri.layers.ArcGISImageServiceLayer",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(m,a){this._url=s.urlToObject(m);var f=a&&a.imageServiceParameters;this.format=f&&f.format;this.interpolation=f?f.interpolation:null;this.compressionQuality=f?f.compressionQuality:null;this.bandIds=f?f.bandIds:null;this.mosaicRule=f?f.mosaicRule:null;this.renderingRule=f?f.renderingRule:null;this._params=
g.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},f?f.toJson():{});this._initLayer=g.hitch(this,this._initLayer);this._queryVisibleRastersHandler=g.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this.useMapImage=a&&a.useMapImage||!1;this.infoTemplate=a&&a.infoTemplate;this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._loadCallback=
a&&a.loadCallback;(f=a&&a.resourceInfo)?this._initLayer(f):t({url:this._url.path,content:g.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(m,a){this._findCredential();(this.credential&&this.credential.ssl||m&&m._ssl)&&this._useSSL();var f=this.minScale,c=this.maxScale;g.mixin(this,m);this.minScale=f;this.maxScale=c;this.initialExtent=this.fullExtent=this.extent=
new C(m.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var h=this.minValues,r=this.maxValues,k=this.meanValues,y=this.stdvValues,b=this.bands=[],f=0,c=this.bandCount;f<c;f++)b[f]={min:h[f],max:r[f],mean:k[f],stddev:y[f]};this.timeInfo=(f=this.timeInfo)&&f.timeExtent?new x(f):null;c=this.fields=[];if(h=m.fields)for(f=0;f<h.length;f++)c.push(new G(h[f]));this.version=m.currentVersion;this.version||
(this.version="fields"in m||"objectIdField"in m||"timeInfo"in m?10:9.3);z.isDefined(m.minScale)&&!this._hasMin&&this.setMinScale(m.minScale);z.isDefined(m.maxScale)&&!this._hasMax&&this.setMaxScale(m.maxScale);f={};m.defaultMosaicMethod?(f.method=m.defaultMosaicMethod,f.operation=m.mosaicOperator,f.sortField=m.sortField,f.sortValue=m.sortValue):f.method=q.METHOD_NONE;this.defaultMosaicRule=new q(f);this.defaultMosaicRule.ascending=!0;10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(g.hitch(this,
function(h){h&&(h.features&&0<h.features.length)&&(this._rasterAttributeTableFeatures=g.clone(h.features));h&&(h.fields&&0<h.fields.length)&&(this._rasterAttributeTableFields=g.clone(h.fields))}));this.loaded=!0;this.onLoad(this);if(f=this._loadCallback)delete this._loadCallback,f(this)},getKeyProperties:function(){var m=this._url.path+"/keyProperties",a=new d(v._dfdCanceller);10<this.version?(a._pendingDfd=t({url:m,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),a._pendingDfd.then(function(m){a.callback(m)},
function(m){a.errback(m)})):(m=Error("Layer does not have key properties"),m.log=l.isDebug,a.errback(m));return a},getRasterAttributeTable:function(){var a=this._url.path+"/rasterAttributeTable",c=new d(v._dfdCanceller);10<this.version&&this.hasRasterAttributeTable?(c._pendingDfd=t({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),c._pendingDfd.then(function(a){c.callback(a)},function(a){c.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=l.isDebug,
c.errback(a));return c},_getRasterAttributeTableFeatures:function(){var a=new d;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(g.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=g.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},getCustomRasterFields:function(a){var c=
a?a.rasterAttributeTableFieldPrefix:"",f={name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};a=this.fields?g.clone(this.fields):[];var b=a.length;a[b]={name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a[b+1]=f;this._rasterAttributeTableFields&&0<this._rasterAttributeTableFields.length&&
(f=p.filter(this._rasterAttributeTableFields,function(h){return"esriFieldTypeOID"!==h.type&&"value"!==h.name.toLowerCase()}),f=p.map(f,function(h){var a=g.clone(h);a.name=c+h.name;return a}),a=a.concat(f));return a},getImageUrl:function(a,d,f,n){var h=a.spatialReference.wkid||b.toJson(a.spatialReference.toJson());delete this._params._ts;var r=this._url.path+"/exportImage?";g.mixin(this._params,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:h,bboxSR:h,size:d+","+f},this.disableClientCaching?
{_ts:(new Date).getTime()}:{});var k=this._params.token=this._getToken();a=s.addProxy(r+c.objectToQuery(g.mixin(this._params,{f:"image"})));a.length>u.defaults.io.postLength||this.useMapImage?this._jsonRequest=t({url:r,content:g.mixin(this._params,{f:"json"}),callbackParamName:"callback",load:function(h,a){var r=h.href;k&&(r+=-1===r.indexOf("?")?"?token\x3d"+k:"\x26token\x3d"+k);n(s.addProxy(r))},error:this._errorHandler}):n(a)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,
c){this.interpolation=this._params.interpolation=a;c||this.refresh(!0)},setCompressionQuality:function(a,c){this.compressionQuality=this._params.compressionQuality=a;c||this.refresh(!0)},setBandIds:function(a,c){var f=!1;this.bandIds!==a&&(f=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(f&&!c)this.onRenderingChange();c||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=
a},setMosaicRule:function(a,c){var f=!1;this.mosaicRule!==a&&(f=!0);this.mosaicRule=a;this._params.mosaicRule=b.toJson(a.toJson());if(f&&!c)this.onMosaicRuleChange();c||this.refresh(!0)},setRenderingRule:function(a,c){var f=!1;this.renderingRule!==a&&(f=!0);this.renderingRule=a;this._params.renderingRule=a?b.toJson(a.toJson()):null;if(f&&!c)this.onRenderingChange();c||this.refresh(!0)},setImageFormat:function(a,c){this.format=this._params.format=a;c||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=
a},setDefinitionExpression:function(a,c){var f=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?f=this.defaultMosaicRule.toJson():f.method=q.METHOD_NONE);f.where=a;f=new q(f);this.setMosaicRule(f,c);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},refresh:function(a){if(a)this.inherited(arguments);else{var c=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=
c}},exportMapImage:function(a,c){var f=u.defaults.map,f=g.mixin({size:f.width+","+f.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete f._ts;this._exportMapImage(this._url.path+"/exportImage",f,c)},queryVisibleRasters:function(a,c,f,b){var h=this._map,r=v._fixDfd(new d(v._dfdCanceller));this._visibleRasters=[];var k,y,g=!0,n;if(this.infoTemplate&&this.infoTemplate.info.fieldInfos&&0<this.infoTemplate.info.fieldInfos.length){g=!1;n=this.infoTemplate.info;for(k=0;k<n.fieldInfos.length;k++)if((y=
n.fieldInfos[k])&&"raster.servicepixelvalue"!==y.fieldName.toLowerCase()&&(y.visible||n.title&&-1<n.title.toLowerCase().indexOf(y.fieldName.toLowerCase()))){g=!0;break}}k=new H;k.geometry=a.geometry;k.returnGeometry=this._map.spatialReference.equals(this.spatialReference);k.returnCatalogItems=g;k.timeExtent=a.timeExtent;k.mosaicRule=this.mosaicRule?this.mosaicRule:null;k.renderingRule=this.renderingRule?this.renderingRule:null;h&&(a=new w((h.extent.xmax-h.extent.xmin)/(2*h.width),(h.extent.ymax-h.extent.ymin)/
(2*h.height),h.extent.spatialReference),k.pixelSize=a);var e=this;a=new F(this.url);(r._pendingDfd=a.execute(k)).addCallbacks(function(a){e._queryVisibleRastersHandler(a,c,f,b,r)},function(a){e._resolve([a],null,b,r,!0)});return r},_queryVisibleRastersHandler:function(a,c,f,n,h){function r(){var a=this.getCustomRasterFields(c),r=this._getDomainFields(a),b=c?c.returnDomainValues:!1,n=c&&c.rasterAttributeTableFieldPrefix,e,m,s,v,l,u,t,w;this._getRasterAttributeTableFeatures().then(g.hitch(this,function(a){for(e=
0;e<d.length;e++){q=d[e];q.setInfoTemplate(this.infoTemplate);q._layer=this;if(k&&(m=k,y&&y.length>=e&&(s=y[e],m=s.replace(/ /gi,", ")),q.attributes["Raster.ItemPixelValue"]=m,q.attributes["Raster.ServicePixelValue"]=k,a&&0<a.length&&(v=p.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==m:a.attributes.VALUE==m}),0<v.length&&(l=g.clone(v[0]),n&&l)))){w={};for(u in l.attributes)l.attributes.hasOwnProperty(u)&&(t=n+u,w[t]=l.attributes[u]);l.attributes=
w;q.attributes=g.mixin(q.attributes,l.attributes)}b&&(r&&0<r.length)&&p.forEach(r,function(a){if(a){var h=q.attributes[a.name];z.isDefined(h)&&(h=this._getDomainValue(a.domain,h),z.isDefined(h)&&(q.attributes[a.name]=h))}},this);x.push(q);this._visibleRasters.push(q)}this._resolve([x,null,!0],null,f,h)}))}var k=a.value,y,d,e=0,s=0,v=this,l=this.objectIdField,u;if(a.catalogItems){n=0;var w,A,B=a.catalogItems.features.length;w=0;d=Array(B);y=Array(B);u=Array(B);for(e=0;e<B;e++)-1<a.properties.Values[e].toLowerCase().indexOf("nodata")&&
w++;w=B-w;for(e=0;e<B;e++)A=-1<a.properties.Values[e].toLowerCase().indexOf("nodata")?w++:n++,d[A]=a.catalogItems.features[e],y[A]=a.properties.Values[e],u[A]=d[A].attributes[l]}this._visibleRasters=[];var q;a=-1<k.toLowerCase().indexOf("nodata");k&&(!d&&!a)&&(l="ObjectId",d=[],q=new E(new C(this.fullExtent),null,{ObjectId:0}),d.push(q));var x=[];d?!this._map.spatialReference.equals(this.spatialReference)&&u&&0<u.length?t({url:this._url.path+"/query",content:{f:"json",objectIds:u.join(","),returnGeometry:!0,
outSR:b.toJson(v._map.spatialReference.toJson()),outFields:l},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)v._resolve([x,null,null],null,f,h);else{for(e=0;e<a.features.length;e++)for(s=0;s<d.length;s++)d[s].attributes[l]==a.features[e].attributes[l]&&(d[s].geometry=new D(a.features[e].geometry),d[s].geometry.setSpatialReference(v._map.spatialReference));r.call(v)}},error:function(a){v._resolve([x,null,null],null,f,h)}}):r.call(this):this._resolve([x,null,
null],null,f,h)},getVisibleRasters:function(){var a=this._visibleRasters,c=[],f;for(f in a)a.hasOwnProperty(f)&&c.push(a[f]);return c},_getDomainFields:function(a){if(a){var c=[];p.forEach(a,function(a){if(a.domain){var b={};b.name=a.name;b.domain=a.domain;c.push(b)}});return c}},_getDomainValue:function(a,c){if(a&&a.codedValues){var b;p.some(a.codedValues,function(a){return a.code===c?(b=a.name,!0):!1});return b}},_resolve:function(a,c,b,d,h){c&&this[c].apply(this,a);b&&b.apply(null,a);d&&v._resDfd(d,
a,h)}});e("extend-esri")&&g.setObject("layers.ArcGISImageServiceLayer",a,n);return a})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(a,g,d,p,b,l){var e=a(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(a){g.isObject(a)&&(g.mixin(this,
a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),a.fids&&(this.objectIds=a.fids),a.viewpoint&&(this.viewpoint=new l(a.viewpoint)))},toJson:function(){var a=null,d=this.multidimensionalDefinition?this.multidimensionalDefinition.length:
0;if(d)for(var a=[],g=0;g<d;g++)a.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[g].declaredClass?this.multidimensionalDefinition[g].toJson():this.multidimensionalDefinition[g]);a={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:a};return b.filter(a,
function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var b=e.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":b=e.METHOD_ATTRIBUTE;break;case "center":b=e.METHOD_CENTER;break;case "lockraster":b=e.METHOD_LOCKRASTER;break;case "nadir":b=e.METHOD_NADIR;break;case "northwest":b=e.METHOD_NORTHWEST;break;case "seamline":b=e.METHOD_SEAMLINE;break;case "viewpoint":b=e.METHOD_VIEWPOINT}return b}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return e.OPERATION_FIRST;
case "last":return e.OPERATION_LAST;case "max":return e.OPERATION_MAX;case "min":return e.OPERATION_MIN;case "blend":return e.OPERATION_BLEND;case "mean":return e.OPERATION_MEAN}}});g.mixin(e,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",
OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND"});d("extend-esri")&&g.setObject("layers.MosaicRule",e,p);return e})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(a,g,d,p,b,l,e){a=a(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,
pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(a){var b=a&&a.geometry||this.geometry;a={geometry:b,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?d.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?d.toJson(this.renderingRule.toJson()):null};b&&(a.geometryType=e.getJsonType(b));b=this.timeExtent;a.time=b?b.toJson().join(","):null;l.isDefined(this.pixelSizeX)&&
l.isDefined(this.pixelSizeY)?a.pixelSize=d.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(a.pixelSize=this.pixelSize?d.toJson(this.pixelSize.toJson()):null);return a}});p("extend-esri")&&g.setObject("tasks.ImageServiceIdentifyParameters",a,b);return a})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(a,g,d,p,b,l,e){a=a(null,{declaredClass:"esri.dijit.Basemap",
id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(a,b){a=a||{};!a.layers&&!a.itemId&&console.error("esri.dijit.Basemap: unable to find the 'layers' property in parameters");this.id=a.id;this.itemId=a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=a.thumbnailUrl;this.basemapGallery=b},getLayers:function(a){if(this.layers)return this.layers;if(this.itemId)return a=l({url:(a||b.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",
content:{f:"json"},callbackParamName:"callback",error:d.hitch(this,function(a,b){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.")})}),a.addCallback(d.hitch(this,function(a,b){if(a.baseMap)return this.layers=[],g.forEach(a.baseMap.baseMapLayers,function(a){this.layers.push(new e(a))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");
else console.error("esri.dijit.Basemap: could not access basemap item.");return[]})),a}});p("extend-esri")&&d.setObject("dijit.Basemap",a,b);return a})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(a,g,d,p){a=a(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(a){a=a||{};!a.url&&!a.type&&console.error("esri.dijit.BasemapLayer: unable to find the 'url' or 'type' property in parameters");this.url=a.url;this.type=
a.type;this.isReference=!0===a.isReference?!0:!1;this.opacity=a.opacity;this.visibleLayers=a.visibleLayers;this.displayLevels=a.displayLevels;this.exclusionAreas=a.exclusionAreas;this.bandIds=a.bandIds;this.copyright=a.copyright;this.subDomains=a.subDomains;this.fullExtent=a.fullExtent;this.initialExtent=a.initialExtent;this.tileInfo=a.tileInfo;this.tileServers=a.tileServers}});d("extend-esri")&&g.setObject("dijit.BasemapLayer",a,p);return a})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(a,g,d,p,b,l,e,c){a=a(e,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(a){this._url.path+="/identify";this._handler=g.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(a,b,d,g,e){try{var s=new c(a);this._successHandler([s],"onComplete",d,e)}catch(l){this._errorHandler(l,g,e)}},execute:function(a,c,d,e){var l=e.assembly;a=this._encode(g.mixin({},this._url.query,{f:"json"},a.toJson(l&&l[0])));var s=this._handler,
p=this._errorHandler;return b({url:this._url.path,content:a,callbackParamName:"callback",load:function(a,b){s(a,b,c,d,e.dfd)},error:function(a){p(a,d,e.dfd)}})},onComplete:function(){}});l._createWrappers(a);d("extend-esri")&&g.setObject("tasks.ImageServiceIdentifyTask",a,p);return a})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/has dojo/string ../kernel ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(a,g,d,p,b,l,e,c,n,u,z,t){a=a(z,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(a,b){b||(b={});this.urlTemplate=a;var c=new u(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new n({wkid:102100})),g=new u(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new n({wkid:102100}));this.initialExtent=b.initialExtent||c;this.fullExtent=b.fullExtent||g;this.tileInfo=b.tileInfo?b.tileInfo:new t({rows:256,cols:256,origin:{x:-2.0037508342787E7,
y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,
scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,
scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.spatialReference=new n(this.tileInfo.spatialReference.toJson());this.copyright=b.copyright||"";var e=new p(a),c=e.scheme+"://"+e.authority+"/";this.urlPath=a.substring(c.length);this.tileServers=b.tileServers||[];-1===e.authority.indexOf("{subDomain}")&&this.tileServers.push(c);if(b.subDomains&&0<b.subDomains.length&&
1<e.authority.split(".").length){this.subDomains=b.subDomains;var q;d.forEach(b.subDomains,function(a,b){-1<e.authority.indexOf("${subDomain}")?q=e.scheme+"://"+l.substitute(e.authority,{subDomain:a})+"/":-1<e.authority.indexOf("{subDomain}")&&(q=e.scheme+"://"+e.authority.replace(/\{subDomain\}/gi,a)+"/");this.tileServers.push(q)},this)}this.tileServers=d.map(this.tileServers,function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a});this._levelToLevelValue=[];d.forEach(this.tileInfo.lods,function(a){this._levelToLevelValue[a.level]=
a.levelValue||a.level},this);this.loaded=!0;this.onLoad(this)},getTileUrl:function(a,b,d){a=this._levelToLevelValue[a];var e=this.tileServers[b%this.tileServers.length]+l.substitute(this.urlPath,{level:a,col:d,row:b}),e=e.replace(/\{level\}/gi,a).replace(/\{row\}/gi,b).replace(/\{col\}/gi,d),e=this.addTimestampToURL(e);return c.addProxy(e)}});b("extend-esri")&&g.setObject("layers.WebTiledLayer",a,e);return a})},"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"*noref":1}});
define("esri/dijit/BasemapGallery","require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../urlUtils ../request ../geometry/Extent ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),function(a,
g,d,p,b,l,e,c,n,u,z,t,v,s,C,w,B,q,A,x,G,E,F,H,D,m,I,f,J){a=g([f,s,C],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:J,basePath:a.toUrl(".")+"/",loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(a,b){a=a||{};a.map||console.error("esri.dijit.BasemapGallery: Unable to find the 'map' property in parameters");
this.map=a.map;this._hasUI=b?!0:!1;this.bingMapsKey=a.bingMapsKey&&0<a.bingMapsKey.length?a.bingMapsKey:null;this.showArcGISBasemaps=!1===a.showArcGISBasemaps?!1:!0;this.basemaps=a.basemaps||[];this.basemapIds=a.basemapIds;this.referenceIds=a.referenceIds;this.basemapsGroup=a.basemapsGroup;this.arcgisUrl=w.dijit._arcgisUrl;a.portalUrl&&(this.arcgisUrl=a.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=window.location.protocol+"//"+this.arcgisUrl:"https:"===window.location.protocol&&
(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));this.init()},init:function(){this.inherited(arguments);d.forEach(this.basemaps,function(a,b){if(!a.id||0===a.id.length)a.id=this._getUniqueId();d.forEach(a.layers,function(a){a.opacity=0<=a.opacity?a.opacity:1;a.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&d.forEach(this.basemapIds,function(a){this.map.getLayer(a)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&d.forEach(this.referenceIds,
function(a){this.map.getLayer(a)._basemapGalleryLayerType="reference"},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(b.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(b.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?this._refreshUI():p.connect(this,"onLoad",b.hitch(this,function(){this._refreshUI()}))},select:function(a){this._select(a)},
getSelected:function(){return this._selectedBasemap},get:function(a){var b;for(b=0;b<this.basemaps.length;b++)if(this.basemaps[b].id==a)return this.basemaps[b];return null},add:function(a){return a&&!a.id?(a.id=this._getUniqueId(),this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):a&&this._isUniqueId(a.id)?(this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):!1},remove:function(a){var b;for(b=0;b<this.basemaps.length;b++){var k=this.basemaps[b];if(k.id===a)return this._selectedBasemap&&
this._selectedBasemap.id===k.id&&(this._selectedBasemap=null),this.basemaps.splice(b,1),this._refreshUI(),this.onRemove(k),k}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(a){},onRemove:function(a){},onError:function(a){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=!0;this.onLoad();0===this.map.layerIds.length&&(0<this.basemaps.length&&!this._selectBasemapInProgress)&&
this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(a){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,a):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(a))},_findArcGISBasemapsGroup:function(a){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(a);else{var r=this.arcgisUrl+"/accounts/self",k={f:"json"};k.culture=l.locale;q({url:r,
content:k,callbackParamName:"callback",load:b.hitch(this,function(b,k){this._basemapGalleryGroupQuery=b&&b.basemapGalleryGroupQuery?b.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(a)}),error:b.hitch(this,function(a,h){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(a){var r=b.hitch(this,"_findArcGISBasemaps"),k=this.arcgisUrl+"/community/groups",c={};c.q=this._basemapGalleryGroupQuery;
c.f="json";q({url:k,content:c,callbackParamName:"callback",load:b.hitch(this,function(b,k){if(0<b.results.length)r(b.results[0].id,a);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:b.hitch(this,function(a){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(a,c){var k=this.arcgisUrl+"/search",d={};d.q="group:"+a+' AND type:"web map"';d.sortField="name";d.sortOrder="desc";d.num=50;d.f="json";q({url:k,
content:d,callbackParamName:"callback",load:b.hitch(this,function(a,h){if(0<a.results.length)c(a.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:b.hitch(this,function(a,h){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_handleArcGISBasemapsResponse:function(a){0<a.length&&(d.forEach(a,function(a,h){if(this.bingMapsKey||!this.bingMapsKey&&a.title&&-1==a.title.indexOf("Bing Maps")){var b={};b.id=this._getUniqueId();
b.title=a.title;b.thumbnailUrl="";if(a.thumbnail&&a.thumbnail.length&&(b.thumbnailUrl=this.arcgisUrl+"/content/items/"+a.id+"/info/"+a.thumbnail,w.id)){var c=w.id.findCredential(B.urlToObject(this.arcgisUrl).path);c&&(b.thumbnailUrl+="?token\x3d"+c.token)}b.itemId=a.id;b=new I(b,this);this.basemaps.splice(0,0,b)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(t.empty(this.flowContainer),d.forEach(this.basemaps,function(a,b){a.id||(a.id="basemap_"+b);this.flowContainer.appendChild(this._buildNodeLayout(a))},
this),t.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(a){var c=t.create("div",{id:"galleryNode_"+a.id,"class":"esriBasemapGalleryNode"}),k=t.create("a",{href:"javascript:void(0);"},c);p.connect(k,"onclick",b.hitch(this,"_onNodeClick",a));a.thumbnailUrl?t.create("img",{"class":"esriBasemapGalleryThumbnail",src:a.thumbnailUrl},k):t.create("img",{"class":"esriBasemapGalleryThumbnail",src:this.basePath.toString()+"images/transparent.gif"},
k);k=t.create("div",{"class":"esriBasemapGalleryLabelContainer"},c);a=a.title||"";t.create("span",{innerHTML:a,alt:a,title:a},k);return c},_onNodeClick:function(a,b){b.preventDefault();this._markSelected(a);this.select(a.id)},_markSelected:function(a){a&&(d.forEach(l.query(".esriBasemapGallerySelectedNode",this.domNode),function(a){v.remove(a,"esriBasemapGallerySelectedNode")}),(a=z.byId("galleryNode_"+a.id))&&v.add(a,"esriBasemapGallerySelectedNode"))},_select:function(a){this._selectBasemapInProgress=
!0;var c=this.get(a);c?(c.layers?this._getServiceInfos(c):(a=c.getLayers(this.arcgisUrl),b.isArray(a)?this._getServiceInfos(c):a.addCallback(b.hitch(this,function(a){this._getServiceInfos(c)}))),this._markSelected(c)):this._selectBasemapInProgress=!1},_getServiceInfos:function(a){"https:"==location.protocol&&d.forEach(a.layers,function(a){if(this._isAgolService(a.url)||this._isHostedService(a.url))a.url=a.url.replace("http:","https:")},this);this._selectedBasemap=a;var c=[];d.forEach(a.layers,function(a){a.url&&
(0<a.url.length&&!a.isReference&&!a.type)&&(a.deferredsPos=c.length,c.push(this._getServiceInfo(a.url)))},this);0<c.length?(new u(c)).addCallback(b.hitch(this,function(b){var c=null;d.forEach(a.layers,function(a){if(0===a.deferredsPos||a.deferredsPos){a.serviceInfoResponse=b[a.deferredsPos][1];var h=a.serviceInfoResponse.fullExtent;h||(h=a.serviceInfoResponse.extent);c=c?c.union(new A(h)):new A(h)}},this);this.map.extent&&5>this._getIntersectionPercent(c,this.map.extent)&&this.map.setExtent(c,!0);
this._switchBasemapLayers(a);this._updateReferenceLayer(a)})):(this._switchBasemapLayers(a),this._updateReferenceLayer(a))},_switchBasemapLayers:function(a){a=a.layers;if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===a[0].type||a[0].type&&-1<a[0].type.indexOf("BingMaps")||"WebTiledLayer"===a[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{d.forEach(a,function(a){if(!a.isReference&&
a.type&&-1<a.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);this._removeBasemapLayers();var b=0;d.forEach(a,function(a){if(!a.isReference){var c;if("OpenStreetMap"===a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=new G({id:"layer_osm",opacity:a.opacity})}else if(a.type&&
-1<a.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=x.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"==a.type?c=x.MAP_STYLE_AERIAL:"BingMapsRoad"==a.type&&(c=x.MAP_STYLE_ROAD);c=new x({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:c,opacity:a.opacity})}else if("WebTiledLayer"==a.type){if(0<this.map.layerIds.length&&
0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=new H(a.url,{visible:a.visibility,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent,initialExtent:a.initialExtent||a.fullExtent,subDomains:a.subDomains,tileInfo:a.tileInfo,tileServers:a.tileServers})}else a.serviceInfoResponse&&a.serviceInfoResponse.mapName?c=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&
!0===a.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):a.serviceInfoResponse&&a.serviceInfoResponse.pixelSizeX&&(c=new m,c.bandIds=a.bandIds,!a.bandIds&&(a.serviceInfoResponse.bandCount&&3<parseInt(a.serviceInfoResponse.bandCount))&&(c.bandIds=[0,1,2]),c=new D(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageServiceParameters:c}));c&&(c._basemapGalleryLayerType="basemap",this.map.addLayer(c,b),b++)}},this);this._selectBasemapInProgress=
!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var a=this.map.layerIds,b=[];d.forEach(a,function(a){a=this.map.getLayer(a);"basemap"===a._basemapGalleryLayerType&&b.push(a)},this);0===b.length&&0<a.length&&b.push(this.map.getLayer(a[0]));0<b.length&&d.forEach(b,function(a){this.map.removeLayer(a)},this)},_updateReferenceLayer:function(a){var b;this._removeReferenceLayer();for(b=0;b<a.layers.length;b++)!0===a.layers[b].isReference&&this._addReferenceLayer(a.layers[b])},_removeReferenceLayer:function(){var a;
for(a=this.map.layerIds.length-1;0<=a;a--){var b=this.map.getLayer(this.map.layerIds[a]);"reference"===b._basemapGalleryLayerType&&this.map.removeLayer(b)}},_addReferenceLayer:function(a){this._getServiceInfo(a.url,b.hitch(this,"_handleReferenceServiceInfoResponse",a))},_handleReferenceServiceInfoResponse:function(a,b,c){var d;(a.serviceInfoResponse=b)&&b.mapName?d=!0===b.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):b&&b.pixelSizeX&&(c=new m,c.bandIds=a.bandIds,!a.bandIds&&(b.bandCount&&
3<parseInt(b.bandCount))&&(c.bandIds=[0,1,2]),d=new D(a.url,{resourceInfo:b,opacity:a.opacity,visible:a.visibility,imageServiceParameters:c}));d&&(d._basemapGalleryLayerType="reference",this.map.addLayer(d))},_getServiceInfo:function(a,c){return q({url:a,content:{f:"json"},callbackParamName:"callback",load:function(a,b){c&&c(a,b)},error:b.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(a){var b=[];a.displayLevels||(b=d.map(a.serviceInfoResponse.tileInfo.lods,
function(a){return a.level}));var c=null;a.exclusionAreas&&a.exclusionAreas.length&&(c=[],d.forEach(a.exclusionAreas,function(a){c.push({minZoom:a.minZoom,maxZoom:a.maxZoom,minScale:a.minScale,maxScale:a.maxScale,geometry:new A(a.geometry)})}));return new E(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,exclusionAreas:c,displayLevels:a.displayLevels||b})},_loadAsDynamic:function(a){var b=new F(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility});
a.visibleLayers&&b.setVisibleLayers(a.visibleLayers);return b},_getIntersectionPercent:function(a,b){var c=b.intersects(a);if(c){var c=c.getWidth()*c.getHeight(),d=b.getWidth()*b.getHeight();return 100*(c/d)}return 0},_getIds:function(){var a=[];d.forEach(this.basemaps,function(b){a.push(b.id)},this);return a},_getUniqueId:function(){for(var a=","+this._getIds().toString()+",",b=0;;)if(-1<a.indexOf(",basemap_"+b+","))b++;else return"basemap_"+b},_isUniqueId:function(a){return-1===(","+this._getIds().toString()+
",").indexOf(","+a+",")?!0:!1},_isAgolService:function(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")},_isHostedService:function(a){return!a?!1:-1!==a.indexOf(".arcgis.com/")}});c("extend-esri")&&b.setObject("dijit.BasemapGallery",a,w);return a});