<div class="alert alert-warning alert-dismissable alert-redirect" style="display: none;">
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
  <div class="translation-info">
    <h3>Language preference detected</h3>
    <p>
      Do you want to see the page translated into <span class="cookie-language-option"></span>?
      <a href ="" class="reload-page-language">Yes, reload the page using my language settings.</a>
    </p>
  </div>
</div>
<div class="translation-info-container" tal:condition="view/is_translated_content">
  <div class="alert alert-warning alert-dismissable">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
    <div class="translation-info">
      <h3>Exclusion of liability</h3>
      <p>
        <span class="show-less">
          This translation is generated by eTranslation, a machine translation tool
          provided by the European Commission.
        </span>
        <button class="more">Show more</button>
        <span class="show-more" style="display: none;">
          Machine translation can give you a
          basic idea of the content in a language you understand. It is fully
          automated and involves no human intervention. The quality and accuracy of
          machine translation can vary significantly from one text to another and
          between different language pairs. The European Commission does not
          guarantee the accuracy and accepts no liability for possible errors.
          Some content (such as images, videos, files, etc.) may not be translated
          due to the technical limitations of the system.
        <span>
      </p>
      <p>
        <span class="show-more" style="display: none;">
          Donâ€™t use eTranslation to translate EU legislation. Authentic versions in
          the 24 official languages are available on
          <a href="https://eur-lex.europa.eu/homepage.html">Eur-Lex</a>.
          See also the
          <a href="https://ec.europa.eu/info/language-policy_en">Europa language policy</a>
          and
          <a href="https://ec.europa.eu/info/legal-notice_en">legal notice</a>
          (includes privacy policy and copyright notice).
        </span>
        <button class="less" style="display: none;">Show less</button>
      </p>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
    $("div.translation-info .show-more").hide();
    $("div.translation-info .show-less").show();

    $("button.more").on("click", function() {
      $("div.translation-info .show-more").show();
      $("button.more").hide();
      $("button.less").show();
    });

    $("button.less").on("click", function() {
      $("div.translation-info .show-more").hide();
      $("button.more").show();
      $("button.less").hide();
    });
    function getCookie(cname) {
      let name = cname + "=";
      let decodedCookie = decodeURIComponent(document.cookie);
      try {
        let ca = decodedCookie.split(';');
        for(let i = 0; i <ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
      } catch (error) {
        return "";
      }
      return "";
    }

    window.onunload = function(){};
    console.log(window.onload);

    const site_language_class = Array.from($("body")[0].classList).find(
      element => element.includes('site-') && element.length == 7);

    if (site_language_class !== undefined) {
      const page_language = site_language_class.split("-")[1];
      const cookie_language = getCookie("I18N_LANGUAGE").replaceAll("\"", "").replaceAll("'", "");
      console.log("Cookie:", cookie_language, "Page content:", page_language);

      if (cookie_language != page_language && cookie_language !== ''){
        $("div.alert.alert-redirect").show();

        const language_names = {"en": "English", "de": "German", "fr": "French", "es": "Spanish", "it": "Italian", "pl": "Polish"};
        $("span.cookie-language-option").text(language_names[cookie_language]);
        var translated = window.location.href.replace("/" + page_language + "/", "/" + cookie_language + "/");
        $("a.reload-page-language").attr("href", translated);
      }
    }
  });
</script>
<style>
div.alert.alert-warning {
  background: #f5d4ab;
  overflow: auto;
  padding: 1em;
}

div.alert.alert-warning.alert-redirect {
  background: #cedce5;
  margin-bottom: 5px;
}

div.alert button.close {
  float: right;
}

button.more,
button.less {
  font-size: 0.8em;
}
</style>
